// src/components/Chessboard.jsx
import React from 'react';
import Square from './Square';
import './Chessboard.css';

const Chessboard = ({ board }) => {
  const boardSize = 8; // Standard chessboard size (8x8)

  // If no board is provided, generate a default random board
  const currentBoard = board || generateInitialBoard();

  // Function to generate the initial board
  function generateInitialBoard() {
    const rows = boardSize;
    const cols = boardSize;
    const initialBoard = Array.from({ length: rows }, () => Array(cols).fill(null));

    // Helper function to place pieces randomly in a given range of rows
    function placePiecesRandomly(startRow, endRow, pieces) {
      let remainingPieces = [...pieces];
      while (remainingPieces.length > 0) {
        const row = Math.floor(Math.random() * (endRow - startRow + 1)) + startRow;
        const col = Math.floor(Math.random() * cols);
        if (initialBoard[row][col] === null) {
          initialBoard[row][col] = remainingPieces.pop();
        }
      }
    }

    // Pieces for the upper half (rows 0-3)
    const upperHalfPieces = ['Q', 'Q', 'R', 'B', 'K'];
    placePiecesRandomly(0, 3, upperHalfPieces);

    // Pieces for the lower half (rows 4-7)
    const lowerHalfPieces = ['Q', 'Q', 'R', 'B', 'K'];
    placePiecesRandomly(4, 7, lowerHalfPieces);

    return initialBoard;
  }

  // Render the chessboard grid
  const renderBoard = () => {
    return currentBoard.map((row, rowIndex) =>
      row.map((piece, colIndex) => (
        <Square
          key={`${rowIndex}-${colIndex}`}
          isDark={(rowIndex + colIndex) % 2 === 0}
          piece={piece}
        />
      ))
    );
  };

  return <div className="chessboard">{renderBoard()}</div>;
};

// Use React.memo to prevent unnecessary re-renders
export default React.memo(Chessboard, (prevProps, nextProps) => {
  // Only re-render if the board prop changes
  return JSON.stringify(prevProps.board) === JSON.stringify(nextProps.board);
});